<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Ceol Gan Eagla ‚Äî Weather</title>

<link rel="manifest" href="manifest.webmanifest">
<link rel="icon" href="favicon.ico">
<link rel="apple-touch-icon" href="icon-192.png">
<meta name="theme-color" content="#0b1220"/>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<style>
:root{--bg:#0b1220;--panel:#12141c;--card:#1a1e29;--text:#eaeaea;--muted:#b9b9c2}
*{box-sizing:border-box}html,body{margin:0;height:100%;background:var(--bg);color:var(--text);font:14px/1.35 system-ui,Segoe UI,Roboto,Arial}
.app{display:grid;grid-template-columns:1fr 420px;gap:12px;height:100vh;padding:12px}
#map{width:100%;height:100%;border-radius:16px;overflow:hidden}
aside{background:var(--panel);border-radius:16px;overflow:auto;padding:12px}
.brand{display:flex;gap:10px;align-items:center;margin-bottom:10px}
.logo{width:40px;height:40px;border-radius:10px;overflow:hidden;background:#000}
.logo img{width:100%;height:100%;object-fit:contain;background:#fff}
h1{font-size:18px;margin:0}.sub{color:var(--muted);font-size:12px}
.card{background:var(--card);border-radius:12px;padding:12px;margin-bottom:10px}
.row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.btn{border:0;padding:8px 10px;border-radius:10px;background:#fff;color:#111;cursor:pointer;font-weight:600}
.btn.ghost{background:transparent;color:var(--text);border:1px solid rgba(255,255,255,.2)}
input[type=range]{width:160px}
#hourly{display:flex;gap:8px;overflow-x:auto;padding-bottom:6px}
.hour{min-width:84px;padding:8px;border-radius:10px;background:rgba(255,255,255,.06);text-align:center}
.hour .ico{width:26px;height:26px;margin:4px auto}
#daily{display:grid;grid-template-columns:repeat(7,minmax(78px,1fr));gap:8px}
.day{padding:8px;border-radius:10px;background:rgba(255,255,255,.06);text-align:center}
.day .ico{width:26px;height:26px;margin:4px auto}
#search{width:100%;border:1px solid rgba(255,255,255,.2);border-radius:10px;padding:10px 12px;background:#0f131c;color:var(--text)}
#suggest{margin-top:6px;border:1px solid rgba(255,255,255,.15);border-radius:10px;overflow:hidden;display:none;max-height:220px;overflow:auto}
.item{padding:10px 12px;border-bottom:1px solid rgba(255,255,255,.08);cursor:pointer}
.item:hover{background:rgba(255,255,255,.06)}
.chip{padding:6px 8px;border-radius:10px;background:rgba(255,255,255,.06);font-size:12px}
@media (max-width:860px){.app{grid-template-columns:1fr;grid-template-rows:50vh 1fr}}
</style>
</head>
<body>
<div class="app">
  <div id="map"></div>
  <aside>
    <div class="brand">
      <div class="logo">
        <img src="./logo.png" alt="Ceol Gan Eagla Logo"
             onerror="this.onerror=null;this.src='./icon-192.png'">
      </div>
      <div>
        <h1>Ceol Gan Eagla ‚Äî Weather</h1>
        <div class="sub">Sources: OSM ‚Ä¢ MapTiler ‚Ä¢ RainViewer ‚Ä¢ Open-Meteo ‚Ä¢ Nominatim</div>
      </div>
    </div>

    <div class="card">
      <input id="search" placeholder="Search place or Eircode‚Ä¶"/>
      <div id="suggest"></div>
    </div>

    <div class="card">
      <div class="row">
        <button id="btnGeo" class="btn">üìç Me</button>
        <button id="btnPin"  class="btn ghost">üìå Pin</button>
        <label>Units
          <select id="units" class="btn ghost">
            <option value="metric" selected>Metric (¬∞C)</option>
            <option value="imperial">Imperial (¬∞F)</option>
          </select>
        </label>
      </div>
    </div>

    <div class="card">
      <div class="row">
        <div id="nowIcon"></div>
        <div class="chip" id="temp">‚Äî</div>
        <div class="chip" id="wind">Wind ‚Äî</div>
        <div class="chip" id="precip">Precip ‚Äî</div>
        <div class="chip" id="cloud">Cloud ‚Äî</div>
        <div class="chip" id="sun">Sunrise ‚Äî / Sunset ‚Äî</div>
        <div class="chip" id="risk">‚Äî</div>
        <div class="chip" id="updated">‚Äî</div>
      </div>
    </div>

    <div class="card">
      <div class="sub" style="margin-bottom:6px">Next 24 hours</div>
      <div id="hourly">Loading‚Ä¶</div>
    </div>
    <div class="card">
      <div class="sub" style="margin-bottom:6px">7-day forecast</div>
      <div id="daily">Loading‚Ä¶</div>
    </div>
  </aside>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
// === CONFIG ===
const MT='MpDV384cXMNO273WsuTG';
const map = L.map('map').setView([53.35,-6.26],7);
L.tileLayer(`https://api.maptiler.com/maps/streets-v2/{z}/{x}/{y}.png?key=${MT}`,{attribution:'&copy; MapTiler &copy; OSM'}).addTo(map);

// === ELEMENTS ===
const el={temp:document.getElementById('temp'),wind:document.getElementById('wind'),precip:document.getElementById('precip'),
cloud:document.getElementById('cloud'),sun:document.getElementById('sun'),risk:document.getElementById('risk'),
updated:document.getElementById('updated'),hourly:document.getElementById('hourly'),daily:document.getElementById('daily'),
nowIcon:document.getElementById('nowIcon')};

function toF(c){return c*9/5+32}
function msToMph(ms){return Math.round(ms*2.23694)}
function mmToIn(mm){return (mm/25.4).toFixed(2)}
function ico(){return `<div class="ico">‚òÅ</div>`}

// === WEATHER FETCH ===
async function loadWeather(lat,lon){
 const metric=document.getElementById('units').value==="metric";
 const url=`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&hourly=temperature_2m,cloudcover,precipitation,weathercode,windspeed_10m,snowfall&daily=temperature_2m_max,temperature_2m_min,sunrise,sunset&forecast_days=7&timezone=auto`;
 const r=await fetch(url); const j=await r.json();

 const tc=j.hourly.temperature_2m[0];
 const wMs=j.hourly.windspeed_10m[0];
 const pMm=j.hourly.precipitation[0];
 const cl=j.hourly.cloudcover[0];
 const snowH=j.hourly.snowfall[0];
 const sunrise=j.daily.sunrise[0], sunset=j.daily.sunset[0];

 el.nowIcon.innerHTML=ico();
 el.temp.textContent= metric? `${tc}¬∞C`:`${Math.round(toF(tc))}¬∞F`;
 el.wind.textContent= metric? `Wind ${wMs} m/s`: `Wind ${msToMph(wMs)} mph`;
 el.precip.textContent= metric? `Precip ${pMm} mm`: `Precip ${mmToIn(pMm)} in`;
 el.cloud.textContent=`Cloud ${cl}%`;
 el.sun.textContent=`Sunrise ${new Date(sunrise).toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'})} / Sunset ${new Date(sunset).toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'})}`;
 el.risk.textContent=(snowH>0?`‚ùÑ snow`:"")+ (cl<=0&&pMm>0?` ‚Ä¢ üåß rain`:``)+(snowH>0?` ‚Ä¢ üßä ice risk`:"");
 el.updated.textContent=`Updated ${new Date().toLocaleTimeString()}`;

 // hourly
 el.hourly.innerHTML="";
 for(let i=0;i<24;i++){
   const d=document.createElement('div'); d.className="hour";
   d.innerHTML=`${j.hourly.time[i].slice(11,16)}<br>${ico()}<br>${metric?j.hourly.temperature_2m[i]+"¬∞C":Math.round(toF(j.hourly.temperature_2m[i]))+"¬∞F"}<br>${metric?j.hourly.precipitation[i]+" mm":mmToIn(j.hourly.precipitation[i])+" in"}`;
   el.hourly.appendChild(d);
 }
 // daily
 el.daily.innerHTML="";
 for(let i=0;i<7;i++){
   const d=document.createElement('div'); d.className="day";
   d.innerHTML=`${new Date(j.daily.time[i]).toLocaleDateString(undefined,{weekday:'short'})}<br>${ico()}<br>${metric?j.daily.temperature_2m_max[i]+"¬∞C / "+j.daily.temperature_2m_min[i]+"¬∞C":Math.round(toF(j.daily.temperature_2m_max[i]))+"¬∞F / "+Math.round(toF(j.daily.temperature_2m_min[i]))+"¬∞F"}`;
   el.daily.appendChild(d);
 }
}
loadWeather(53.35,-6.26);
</script>
</body>
</html>
